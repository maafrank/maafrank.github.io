<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&amp;subset=devanagari,latin-ext" rel="stylesheet">
    <title>Lesson 1: Financial Markets & Data - Quantitative Trading Course</title>
    <link rel="shortcut icon" type="image/icon" href="../../assets/logo/favicon.png"/>
    <link rel="stylesheet" href="../../assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../assets/css/bootsnav.css">	
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
      .lesson-container { min-height: 100vh; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 30px 0; }
      .lesson-header { text-align: center; color: #333; margin-bottom: 40px; padding: 40px 0; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 15px; }
      .lesson-header h1 { font-size: 2.8rem; margin-bottom: 15px; color: #28a745; }
      .lesson-header .lesson-meta { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 20px; font-size: 1rem; color: #666; }
      .back-link { position: absolute; top: 20px; left: 20px; color: #28a745; font-size: 1.2rem; text-decoration: none; transition: all 0.3s ease; z-index: 10; }
      .back-link:hover { color: #1e7e34; text-decoration: none; }
      .lesson-content { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 30px; }
      .lesson-content h2 { color: #28a745; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #f0f2f5; }
      .lesson-content h3 { color: #333; margin: 25px 0 15px 0; }
      .lesson-content p { line-height: 1.8; color: #555; margin-bottom: 20px; }
      .code-section { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 30px; border-radius: 15px; margin: 30px 0; }
      .code-example { background: #2d3748; border-radius: 10px; padding: 20px; margin: 20px 0; overflow-x: auto; }
      .code-example pre { margin: 0; background: none !important; padding: 0 !important; }
      .code-example code { color: #e2e8f0; font-family: 'Courier New', monospace; font-size: 0.9rem; }
      .output-box { background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #4299e1; }
      .exercise-box { background: #e8f4fd; border-left: 4px solid #007bff; padding: 25px; border-radius: 10px; margin: 30px 0; }
      .exercise-box h3 { color: #007bff; margin-bottom: 20px; }
      .market-info { background: #d4edda; border-left: 4px solid #28a745; padding: 25px; border-radius: 10px; margin: 30px 0; }
      .market-info h3 { color: #28a745; margin-bottom: 20px; }
      .navigation-buttons { display: flex; justify-content: space-between; margin-top: 40px; flex-wrap: wrap; gap: 15px; }
      .btn-nav { padding: 12px 25px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; border: none; cursor: pointer; }
      .btn-primary { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
      .btn-primary:hover { color: white; text-decoration: none; box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4); }
      .btn-secondary { background: #6c757d; color: white; }
      .btn-secondary:hover { background: #5a6268; color: white; text-decoration: none; }
      .warning-box { background: #f8d7da; border-left: 4px solid #dc3545; padding: 20px; border-radius: 8px; margin: 20px 0; }
      .warning-box h4 { color: #721c24; margin-bottom: 10px; }
      .instrument-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
      .instrument-card { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #28a745; }
    </style>
  </head>
  
  <body>
    <a href="../quant-course.html" class="back-link"><i class="fa fa-arrow-left"></i> Back to Course</a>
    
    <div class="lesson-container">
      <div class="container">
        <div class="lesson-header">
          <h1><i class="fa fa-university"></i> Financial Markets & Data</h1>
          <p>Understanding markets, instruments, and data sources for algorithmic trading</p>
          <div class="lesson-meta">
            <span><i class="fa fa-clock-o"></i> 45-60 minutes</span>
            <span><i class="fa fa-bar-chart"></i> Beginner Level</span>
            <span><i class="fa fa-database"></i> Real Market Data</span>
          </div>
        </div>

        <div class="lesson-content">
          <h2>Introduction to Financial Markets</h2>
          <p>Financial markets are complex ecosystems where various instruments are traded. As quantitative traders, we need to understand these markets, the instruments available, and how to access and analyze market data programmatically.</p>
          
          <div class="market-info">
            <h3><i class="fa fa-info-circle"></i> Key Financial Markets</h3>
            <div class="instrument-grid">
              <div class="instrument-card">
                <h4>üèõÔ∏è Equity Markets</h4>
                <p><strong>What:</strong> Stocks and shares of public companies</p>
                <p><strong>Examples:</strong> AAPL, GOOGL, TSLA</p>
                <p><strong>Trading Hours:</strong> 9:30 AM - 4:00 PM EST</p>
                <p><strong>Volatility:</strong> Medium to High</p>
              </div>
              
              <div class="instrument-card">
                <h4>üí± Forex (FX)</h4>
                <p><strong>What:</strong> Currency pairs and exchange rates</p>
                <p><strong>Examples:</strong> EUR/USD, GBP/JPY, USD/CAD</p>
                <p><strong>Trading Hours:</strong> 24/5 (Sunday 5 PM - Friday 5 PM EST)</p>
                <p><strong>Volatility:</strong> Low to Medium</p>
              </div>
              
              <div class="instrument-card">
                <h4>üåæ Commodities</h4>
                <p><strong>What:</strong> Raw materials and agricultural products</p>
                <p><strong>Examples:</strong> Gold, Oil, Wheat, Coffee</p>
                <p><strong>Trading Hours:</strong> Varies by commodity</p>
                <p><strong>Volatility:</strong> Medium to High</p>
              </div>
              
              <div class="instrument-card">
                <h4>üè¶ Fixed Income</h4>
                <p><strong>What:</strong> Bonds and government securities</p>
                <p><strong>Examples:</strong> US Treasury Bonds, Corporate Bonds</p>
                <p><strong>Trading Hours:</strong> 8:00 AM - 5:00 PM EST</p>
                <p><strong>Volatility:</strong> Low</p>
              </div>
              
              <div class="instrument-card">
                <h4>‚ö° Derivatives</h4>
                <p><strong>What:</strong> Contracts based on underlying assets</p>
                <p><strong>Examples:</strong> Options, Futures, Swaps</p>
                <p><strong>Trading Hours:</strong> Varies by contract</p>
                <p><strong>Volatility:</strong> High</p>
              </div>
              
              <div class="instrument-card">
                <h4>‚Çø Cryptocurrencies</h4>
                <p><strong>What:</strong> Digital currencies and tokens</p>
                <p><strong>Examples:</strong> BTC, ETH, ADA</p>
                <p><strong>Trading Hours:</strong> 24/7</p>
                <p><strong>Volatility:</strong> Very High</p>
              </div>
            </div>
          </div>

          <h2>Market Data Fundamentals</h2>
          <p>Understanding different types of market data is crucial for building trading algorithms.</p>

          <h3>Types of Market Data</h3>
          <ul>
            <li><strong>Level 1 Data:</strong> Best bid/ask prices and sizes</li>
            <li><strong>Level 2 Data:</strong> Full order book depth</li>
            <li><strong>Time & Sales:</strong> All executed transactions</li>
            <li><strong>Historical Data:</strong> Past price movements and volumes</li>
            <li><strong>Fundamental Data:</strong> Company financials, earnings, ratios</li>
            <li><strong>Alternative Data:</strong> Social media, satellite imagery, news sentiment</li>
          </ul>

          <h2>Setting Up Your Trading Environment</h2>
          <p>Let's set up Python libraries and data sources for quantitative trading.</p>
          
          <div class="code-section">
            <h3>üöÄ Environment Setup</h3>
            <div class="code-example">
              <pre><code class="language-python"># Install required packages
# pip install yfinance pandas numpy matplotlib seaborn plotly
# pip install scipy scikit-learn ta-lib

import yfinance as yf
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from datetime import datetime, timedelta
import warnings
warnings.filterwarnings('ignore')

# Set up plotting style
plt.style.use('seaborn-v0_8')
sns.set_palette("husl")

print("Trading environment setup complete!")
print(f"Python libraries loaded successfully")
print(f"Ready to fetch and analyze market data")</code></pre>
            </div>
            
            <div class="output-box">
              <strong>Expected Output:</strong><br>
              Trading environment setup complete!<br>
              Python libraries loaded successfully<br>
              Ready to fetch and analyze market data
            </div>
          </div>

          <h2>Fetching Market Data with yfinance</h2>
          <p>yfinance is a popular Python library that provides easy access to Yahoo Finance data.</p>

          <div class="market-info">
            <h3><i class="fa fa-lightbulb-o"></i> Why These Parameters Matter</h3>
            <p><strong>Time Period Selection:</strong> The <code>period="1y"</code> parameter gives us enough historical data to identify trends and patterns, but not so much that we include irrelevant old market regimes. For day trading strategies, you might use shorter periods like "1mo", while long-term investors might prefer "5y" or "max".</p>
            
            <p><strong>Interval Choice:</strong> The <code>interval="1d"</code> gives us daily data, which is perfect for swing trading and longer-term strategies. Intraday traders would use "1m" or "5m" for minute-level data, while position traders might use "1wk" for weekly data. Remember: higher frequency = more data points but also more noise.</p>
            
            <p><strong>Market Data Quality:</strong> We're not just grabbing data randomly - we need to understand what we're getting. Each data point represents real market activity where millions of dollars changed hands. The quality and completeness of this data directly impacts our strategy's success.</p>
          </div>

          <div class="code-example">
            <pre><code class="language-python"># Fetch stock data for Apple (AAPL)
def get_stock_data(symbol, period="1y", interval="1d"):
    """
    Fetch stock data using yfinance
    
    Parameters:
    symbol: Stock ticker (e.g., 'AAPL', 'GOOGL')
    period: Data period (1d, 5d, 1mo, 3mo, 6mo, 1y, 2y, 5y, 10y, ytd, max)
    interval: Data interval (1m, 2m, 5m, 15m, 30m, 60m, 90m, 1h, 1d, 5d, 1wk, 1mo, 3mo)
    """
    stock = yf.Ticker(symbol)
    data = stock.history(period=period, interval=interval)
    
    # Get additional info
    info = stock.info
    
    return data, info

# Example: Get Apple stock data
print("Fetching Apple (AAPL) stock data...")
aapl_data, aapl_info = get_stock_data("AAPL", period="1y")

print(f"Data shape: {aapl_data.shape}")
print(f"Date range: {aapl_data.index[0].date()} to {aapl_data.index[-1].date()}")
print(f"Columns: {list(aapl_data.columns)}")

# Display basic info
print(f"\nCompany: {aapl_info.get('longName', 'N/A')}")
print(f"Sector: {aapl_info.get('sector', 'N/A')}")
print(f"Market Cap: ${aapl_info.get('marketCap', 0):,}")
print(f"52 Week High: ${aapl_info.get('fiftyTwoWeekHigh', 0):.2f}")
print(f"52 Week Low: ${aapl_info.get('fiftyTwoWeekLow', 0):.2f}")

# Show first few rows
print("\nFirst 5 rows of data:")
print(aapl_data.head())</code></pre>
          </div>

          <h3>Understanding OHLCV Data</h3>
          <div class="code-example">
            <pre><code class="language-python"># Analyze OHLCV data structure
def analyze_ohlcv_data(data, symbol):
    """Analyze Open, High, Low, Close, Volume data"""
    
    print(f"=== {symbol} OHLCV Analysis ===")
    print(f"Total trading days: {len(data)}")
    print(f"Date range: {data.index[0].date()} to {data.index[-1].date()}")
    
    # Price statistics
    print(f"\n=== Price Statistics ===")
    print(f"Highest Close: ${data['Close'].max():.2f}")
    print(f"Lowest Close: ${data['Close'].min():.2f}")
    print(f"Average Close: ${data['Close'].mean():.2f}")
    print(f"Current Price: ${data['Close'].iloc[-1]:.2f}")
    
    # Volume statistics
    print(f"\n=== Volume Statistics ===")
    print(f"Average Daily Volume: {data['Volume'].mean():,.0f}")
    print(f"Highest Volume Day: {data['Volume'].max():,.0f}")
    print(f"Most recent volume: {data['Volume'].iloc[-1]:,.0f}")
    
    # Calculate basic metrics
    data['Daily_Return'] = data['Close'].pct_change()
    data['Price_Range'] = data['High'] - data['Low']
    data['Body_Size'] = abs(data['Close'] - data['Open'])
    
    print(f"\n=== Volatility Metrics ===")
    print(f"Average Daily Return: {data['Daily_Return'].mean()*100:.2f}%")
    print(f"Daily Return Std Dev: {data['Daily_Return'].std()*100:.2f}%")
    print(f"Average Price Range: ${data['Price_Range'].mean():.2f}")
    
    return data

# Analyze Apple data
aapl_analyzed = analyze_ohlcv_data(aapl_data.copy(), "AAPL")</code></pre>
          </div>

          <div class="exercise-box">
            <h3><i class="fa fa-brain"></i> Understanding the Numbers Behind the Markets</h3>
            <p><strong>Why These Calculations Matter:</strong> We're not just crunching numbers for fun - each metric tells us something crucial about market behavior:</p>
            
            <ul>
              <li><strong>Daily Returns:</strong> The percentage change from one day to the next reveals the asset's volatility and trend strength. Consistent positive returns suggest an uptrend, while high standard deviation means the asset is risky.</li>
              
              <li><strong>Price Range (High - Low):</strong> Shows intraday volatility. A stock with large daily ranges might offer more trading opportunities but also carries higher risk. Professional traders use this to set stop-losses and profit targets.</li>
              
              <li><strong>Volume Analysis:</strong> High volume confirms price movements. When prices break resistance with high volume, it's more reliable than low-volume breakouts. Institutions moving large amounts of money create volume spikes.</li>
              
              <li><strong>Body Size (|Close - Open|):</strong> In candlestick terms, this shows conviction. Large bodies indicate strong buying or selling pressure, while small bodies suggest indecision or consolidation.</li>
            </ul>
            
            <p><strong>Trading Insight:</strong> These aren't just statistics - they're the building blocks for every trading strategy. Momentum strategies look for consistent returns, mean reversion strategies look for high volatility, and volume strategies confirm price movements with institutional activity.</p>
          </div>

          <h2>Visualizing Market Data</h2>
          <p>Visualization is crucial for understanding price movements and patterns. Charts reveal information that raw numbers can't convey - support and resistance levels, trend channels, and breakout patterns that form the basis of technical analysis.</p>
          
          <div class="code-example">
            <pre><code class="language-python"># Create comprehensive price charts
def plot_stock_analysis(data, symbol, days=90):
    """Create a comprehensive stock analysis chart"""
    
    # Get recent data
    recent_data = data.tail(days).copy()
    
    # Create subplots
    fig = make_subplots(
        rows=3, cols=1,
        subplot_titles=(f'{symbol} Price Chart', 'Volume', 'Daily Returns'),
        vertical_spacing=0.08,
        row_width=[0.7, 0.15, 0.15]
    )
    
    # Candlestick chart
    fig.add_trace(
        go.Candlestick(
            x=recent_data.index,
            open=recent_data['Open'],
            high=recent_data['High'],
            low=recent_data['Low'],
            close=recent_data['Close'],
            name='Price'
        ),
        row=1, col=1
    )
    
    # Volume chart
    colors = ['red' if close < open else 'green' 
              for close, open in zip(recent_data['Close'], recent_data['Open'])]
    
    fig.add_trace(
        go.Bar(
            x=recent_data.index,
            y=recent_data['Volume'],
            name='Volume',
            marker_color=colors
        ),
        row=2, col=1
    )
    
    # Daily returns
    daily_returns = recent_data['Close'].pct_change() * 100
    colors_returns = ['red' if ret < 0 else 'green' for ret in daily_returns]
    
    fig.add_trace(
        go.Bar(
            x=recent_data.index,
            y=daily_returns,
            name='Daily Return %',
            marker_color=colors_returns
        ),
        row=3, col=1
    )
    
    # Update layout
    fig.update_layout(
        title=f'{symbol} Market Analysis - Last {days} Days',
        xaxis_rangeslider_visible=False,
        height=800,
        showlegend=False
    )
    
    fig.show()
    
    return fig

# Plot Apple analysis
print("Creating comprehensive AAPL chart...")
aapl_chart = plot_stock_analysis(aapl_analyzed, "AAPL", days=90)</code></pre>
          </div>

          <div class="market-info">
            <h3><i class="fa fa-chart-line"></i> Why Visualization Matters in Trading</h3>
            <p><strong>Pattern Recognition:</strong> Our brains are wired to recognize visual patterns. A chart can instantly reveal trends, support/resistance levels, and breakout patterns that would take hours to identify in raw data. Professional traders rely on charts because they compress thousands of data points into actionable insights.</p>
            
            <p><strong>Candlestick Charts:</strong> We use candlesticks (not simple line charts) because they show four critical pieces of information: opening price (market sentiment at open), closing price (final sentiment), high (maximum optimism), and low (maximum pessimism). The "body" and "wicks" tell stories about buyer vs seller control.</p>
            
            <p><strong>Volume Confirmation:</strong> The volume subplot is crucial - price movements mean more when accompanied by high volume. A breakout on low volume might be a false signal, while high-volume moves often indicate institutional involvement and are more likely to continue.</p>
          </div>

          <h2>Multi-Symbol Data Collection</h2>
          <p>Quantitative strategies often involve multiple assets. Let's learn to collect and compare data across different instruments.</p>
          
          <div class="warning-box">
            <h4><i class="fa fa-exclamation-triangle"></i> Why Portfolio Thinking Matters</h4>
            <p>Single-stock strategies are risky and inefficient. Professional quantitative traders think in portfolios because:</p>
            <ul>
              <li><strong>Diversification:</strong> Multiple assets reduce specific company risk</li>
              <li><strong>Opportunity Cost:</strong> While one stock consolidates, others might be trending</li>
              <li><strong>Market Regimes:</strong> Different assets perform better in different market conditions</li>
              <li><strong>Correlation Analysis:</strong> Understanding how assets move together helps optimize portfolio risk</li>
            </ul>
          </div>
          
          <div class="code-example">
            <pre><code class="language-python"># Collect data for multiple symbols
def get_multiple_stocks(symbols, period="6mo"):
    """
    Fetch data for multiple stocks
    
    Parameters:
    symbols: List of stock tickers
    period: Data period
    """
    all_data = {}
    
    print(f"Fetching data for {len(symbols)} symbols...")
    
    for symbol in symbols:
        try:
            print(f"  Downloading {symbol}...")
            stock = yf.Ticker(symbol)
            data = stock.history(period=period)
            
            if not data.empty:
                all_data[symbol] = data
                print(f"    ‚úÖ {symbol}: {len(data)} days")
            else:
                print(f"    ‚ùå {symbol}: No data available")
                
        except Exception as e:
            print(f"    ‚ùå {symbol}: Error - {str(e)}")
    
    return all_data

# Example: Tech stocks
tech_symbols = ['AAPL', 'GOOGL', 'MSFT', 'AMZN', 'TSLA', 'META', 'NFLX', 'NVDA']
tech_data = get_multiple_stocks(tech_symbols, period="6mo")

print(f"\nSuccessfully collected data for {len(tech_data)} symbols")

# Create a price comparison
def compare_stock_performance(stock_data, normalize=True):
    """Compare performance of multiple stocks"""
    
    # Extract closing prices
    prices = pd.DataFrame()
    for symbol, data in stock_data.items():
        prices[symbol] = data['Close']
    
    # Remove any NaN values
    prices = prices.dropna()
    
    if normalize:
        # Normalize to starting price (percentage change)
        normalized_prices = prices / prices.iloc[0] * 100
        
        plt.figure(figsize=(12, 8))
        for symbol in normalized_prices.columns:
            plt.plot(normalized_prices.index, normalized_prices[symbol], 
                    label=symbol, linewidth=2)
        
        plt.title('Normalized Stock Performance Comparison (Starting at 100)')
        plt.ylabel('Normalized Price')
        plt.xlabel('Date')
        plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
        plt.grid(True, alpha=0.3)
        plt.tight_layout()
        plt.show()
        
        return normalized_prices
    else:
        # Plot actual prices
        plt.figure(figsize=(12, 8))
        for symbol in prices.columns:
            plt.plot(prices.index, prices[symbol], label=symbol, linewidth=2)
        
        plt.title('Stock Price Comparison')
        plt.ylabel('Price ($)')
        plt.xlabel('Date')
        plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left')
        plt.grid(True, alpha=0.3)
        plt.tight_layout()
        plt.show()
        
        return prices

# Compare tech stock performance
print("Comparing tech stock performance...")
tech_performance = compare_stock_performance(tech_data, normalize=True)</code></pre>
          </div>

          <h2>Market Data Quality and Preprocessing</h2>
          <p>Real market data often contains gaps, errors, and anomalies. Let's learn to identify and handle these issues.</p>
          
          <div class="market-info">
            <h3><i class="fa fa-wrench"></i> Why Data Quality Matters in Trading</h3>
            <p><strong>Garbage In, Garbage Out:</strong> Poor data quality can lead to false signals, incorrect backtests, and real trading losses. A single bad data point can trigger a stop-loss or cause a momentum algorithm to buy at the wrong time. Professional trading firms spend millions on data quality because clean data is the foundation of profitable strategies.</p>
            
            <p><strong>Common Data Issues:</strong> Corporate actions (stock splits, dividends), exchange holidays, market halts, and data vendor errors can create gaps or spikes in price data. We need to identify these systematically rather than discovering them during live trading when it's too late.</p>
            
            <p><strong>Financial Impact:</strong> A trading algorithm that doesn't handle data quality issues might mistake a stock split for a 50% price drop, triggering massive buy orders. Or it might ignore a trading halt and assume liquidity exists when it doesn't. These aren't theoretical problems - they cause real losses.</p>
          </div>
          
          <div class="code-example">
            <pre><code class="language-python"># Data quality analysis
def analyze_data_quality(data, symbol):
    """Analyze data quality and identify potential issues"""
    
    print(f"=== Data Quality Analysis for {symbol} ===")
    
    # Basic statistics
    print(f"Total rows: {len(data)}")
    print(f"Date range: {data.index[0].date()} to {data.index[-1].date()}")
    
    # Check for missing values
    missing_data = data.isnull().sum()
    print(f"\nMissing values:")
    for col, missing in missing_data.items():
        if missing > 0:
            print(f"  {col}: {missing} ({missing/len(data)*100:.1f}%)")
        else:
            print(f"  {col}: None")
    
    # Check for zero/negative prices
    price_cols = ['Open', 'High', 'Low', 'Close']
    for col in price_cols:
        zero_prices = (data[col] <= 0).sum()
        if zero_prices > 0:
            print(f"\n‚ö†Ô∏è  Warning: {col} has {zero_prices} zero/negative values")
    
    # Check for zero volume
    zero_volume = (data['Volume'] == 0).sum()
    if zero_volume > 0:
        print(f"\n‚ö†Ô∏è  Warning: {zero_volume} days with zero volume")
    
    # Check for OHLC consistency
    inconsistent_ohlc = 0
    if 'High' in data.columns and 'Low' in data.columns:
        inconsistent_ohlc = (data['High'] < data['Low']).sum()
        if inconsistent_ohlc > 0:
            print(f"\n‚ö†Ô∏è  Warning: {inconsistent_ohlc} days where High < Low")
    
    # Check for extreme price movements (>20% in one day)
    daily_returns = data['Close'].pct_change()
    extreme_moves = (abs(daily_returns) > 0.20).sum()
    if extreme_moves > 0:
        print(f"\nüìà Note: {extreme_moves} days with >20% price movement")
        extreme_dates = data[abs(daily_returns) > 0.20].index
        for date in extreme_dates[:5]:  # Show first 5
            ret = daily_returns[date] * 100
            print(f"  {date.date()}: {ret:+.1f}%")
    
    # Gap analysis (missing trading days)
    expected_trading_days = pd.bdate_range(start=data.index[0], end=data.index[-1])
    actual_days = set(data.index.date)
    expected_days = set(expected_trading_days.date)
    missing_days = expected_days - actual_days
    
    if missing_days:
        print(f"\nüìÖ Missing trading days: {len(missing_days)}")
        if len(missing_days) <= 10:
            for day in sorted(missing_days)[:5]:
                print(f"  {day}")
    
    return {
        'missing_values': missing_data,
        'zero_volume_days': zero_volume,
        'inconsistent_ohlc': inconsistent_ohlc,
        'extreme_moves': extreme_moves,
        'missing_trading_days': len(missing_days)
    }

# Analyze Apple data quality
aapl_quality = analyze_data_quality(aapl_data, "AAPL")

# Clean data function
def clean_market_data(data):
    """Clean and preprocess market data"""
    
    cleaned_data = data.copy()
    
    # Remove rows with any missing values
    cleaned_data = cleaned_data.dropna()
    
    # Remove rows with zero/negative prices
    price_cols = ['Open', 'High', 'Low', 'Close']
    for col in price_cols:
        cleaned_data = cleaned_data[cleaned_data[col] > 0]
    
    # Fix OHLC inconsistencies (set Low to min of OHLC, High to max)
    cleaned_data['Low'] = cleaned_data[['Open', 'High', 'Low', 'Close']].min(axis=1)
    cleaned_data['High'] = cleaned_data[['Open', 'High', 'Low', 'Close']].max(axis=1)
    
    print(f"Data cleaning complete:")
    print(f"  Original rows: {len(data)}")
    print(f"  Cleaned rows: {len(cleaned_data)}")
    print(f"  Removed: {len(data) - len(cleaned_data)} rows")
    
    return cleaned_data

# Clean Apple data
aapl_clean = clean_market_data(aapl_data)</code></pre>
          </div>
          
          <div class="exercise-box">
            <h3><i class="fa fa-cogs"></i> Understanding Data Preprocessing in Finance</h3>
            <p><strong>Why We Clean Data This Way:</strong> Each cleaning step serves a specific purpose in quantitative trading:</p>
            
            <ul>
              <li><strong>Removing Missing Values:</strong> Gaps in price data can cause algorithms to make incorrect assumptions about market continuity. Better to skip a day than use interpolated data that doesn't reflect real market conditions.</li>
              
              <li><strong>Zero/Negative Price Filters:</strong> These are data errors that can break mathematical calculations (like log returns) or cause algorithms to think an asset is free. In real markets, assets have positive prices.</li>
              
              <li><strong>OHLC Consistency:</strong> When High < Low or Close is outside the High-Low range, it indicates data corruption. We fix this conservatively by ensuring the range encompasses all prices, preserving the trading range information.</li>
              
              <li><strong>Extreme Move Detection:</strong> Moves >20% in a day are rare but legitimate (earnings, news, market crashes). We flag them for investigation rather than removing them, as they might represent real trading opportunities.</li>
            </ul>
            
            <p><strong>Professional Approach:</strong> In institutional trading, data quality is monitored in real-time with alerts for anomalies. We're building good habits by implementing these checks in our educational framework - the same principles apply whether you're managing $1,000 or $100 million.</p>
          </div>

          <div class="warning-box">
            <h4><i class="fa fa-exclamation-triangle"></i> Important Disclaimers</h4>
            <ul>
              <li><strong>Educational Purpose:</strong> This course is for educational purposes only</li>
              <li><strong>Risk Warning:</strong> Trading involves substantial risk of loss</li>
              <li><strong>No Investment Advice:</strong> Nothing here constitutes investment advice</li>
              <li><strong>Paper Trading First:</strong> Always test strategies with paper money first</li>
              <li><strong>Data Limitations:</strong> Free data sources may have limitations and delays</li>
            </ul>
          </div>

          <div class="exercise-box">
            <h3><i class="fa fa-code"></i> Hands-On Exercise</h3>
            <p>Practice working with real market data!</p>
            
            <h4>Exercise 1: Multi-Asset Data Collection</h4>
            <p>Collect and analyze data for different asset classes:</p>
            <ul>
              <li>Stocks: Choose 3 companies from different sectors</li>
              <li>ETFs: SPY (S&P 500), QQQ (NASDAQ), IWM (Russell 2000)</li>
              <li>Commodities: GLD (Gold), USO (Oil)</li>
              <li>Cryptocurrencies: BTC-USD, ETH-USD</li>
            </ul>
            
            <div class="code-example">
              <pre><code class="language-python"># Your solution here
def multi_asset_analysis():
    """Analyze different asset classes"""
    
    # Define symbols for different asset classes
    assets = {
        'stocks': ['AAPL', 'JPM', 'JNJ'],  # Your choices here
        'etfs': ['SPY', 'QQQ', 'IWM'],
        'commodities': ['GLD', 'USO'],
        'crypto': ['BTC-USD', 'ETH-USD']
    }
    
    # Your code to:
    # 1. Fetch data for all symbols
    # 2. Calculate basic statistics
    # 3. Compare volatility across asset classes
    # 4. Create visualization
    
    pass

# Run your analysis
multi_asset_analysis()</code></pre>
            </div>
            
            <h4>Exercise 2: Data Quality Dashboard</h4>
            <p>Create a comprehensive data quality dashboard:</p>
            
            <div class="code-example">
              <pre><code class="language-python"># Create a data quality dashboard
def create_data_quality_dashboard(symbols, period="1y"):
    """Create a dashboard showing data quality metrics for multiple symbols"""
    
    quality_summary = []
    
    for symbol in symbols:
        # Your code to:
        # 1. Fetch data
        # 2. Analyze quality
        # 3. Store results
        pass
    
    # Your code to:
    # 1. Create summary DataFrame
    # 2. Generate visualizations
    # 3. Identify best/worst data quality
    
    return quality_summary

# Test your dashboard
test_symbols = ['AAPL', 'GOOGL', 'TSLA', 'SPY', 'BTC-USD']
dashboard = create_data_quality_dashboard(test_symbols)</code></pre>
            </div>
          </div>

          <h2>Key Takeaways</h2>
          <p>In this lesson, you've learned the foundations of quantitative trading:</p>
          <ul>
            <li><strong>Market Structure:</strong> Understanding different financial markets and instruments</li>
            <li><strong>Data Types:</strong> OHLCV data, volume, and market microstructure</li>
            <li><strong>Data Collection:</strong> Using yfinance to fetch real market data</li>
            <li><strong>Data Quality:</strong> Identifying and cleaning data issues</li>
            <li><strong>Visualization:</strong> Creating informative charts for analysis</li>
            <li><strong>Multi-Asset Analysis:</strong> Comparing different instruments and asset classes</li>
          </ul>
          
          <p>Next, we'll dive into technical analysis and learn to calculate trading indicators that form the basis of many quantitative strategies!</p>
        </div>

        <div class="navigation-buttons">
          <a href="../quant-course.html" class="btn-nav btn-secondary">
            <i class="fa fa-arrow-left"></i> Back to Course
          </a>
          <a href="lesson-2-technical-analysis.html" class="btn-nav btn-primary">
            Next: Technical Analysis <i class="fa fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
      // Mark lesson as completed when user scrolls to bottom
      window.addEventListener('scroll', function() {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
          localStorage.setItem('quant_lesson_1_completed', 'true');
        }
      });
    </script>
  </body>
</html>